<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ошибка 502</title>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
            crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script>
        var appDev = window.location.hostname === '127.0.0.1'
        var appUrl = appDev ? 'http://127.0.0.1:8401' : 'https://devops.fandeco.org'
    </script>

</head>
<body style="background-color:#f8f9fa">

<div class="container-fluid">
    <div class="m-5">
        <div class="m-5 text-center">
            <div class="row">
                <div class="col-md-12">

                    <h1 class="display-1">502</h1>
                    <h2 class="display-4">Bad Gateway</h2>
                    <p class="lead">Сервер не смог выполнить запрос из-за неверного ответа от другого сервера.</p>
                    <p class="lead">Попробуйте повторить запрос позже.</p>


                    <!--  <a href="{{ route('home') }}" class="btn btn-primary">На главную</a>-->


                    <div class="status" style="display: none" id="status_not_found">
                        <div class="status__code">Домен не найден</div>
                        <div class="status__text">Скорей всего вы ошиблись доменом</div>
                    </div>
                    <div class="status" style="display: none" id="status_found">
                        <div>Домен <b id="domain"></b> <span id="domain_state">доступен</span></div>
                        <div class="status__code"></div>
                        <br>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>


<script>
    $(document).ready(function () {

        var domain = appDev ? 'astep-fandeco.massive.ru' : window.location.hostname
        requestAjax('/api/build/domain/' + domain, function (data) {
            if (data.status && data.status === 404) {
            } else {

                $('#status_found').show()
                $('#domain').html(data.domain)

                if (data.state !== 'finished') {
                    $('#domain_state').html('сборка в процессе')
                    $('.status__code').html(data.message)
                } else {

                    if (data.status_code === 200) {
                        $('#domain_state').html('доступе')
                    } else {
                        $('.status__message').show()
                        $('.status__message').html(data.message)
                    }
                }
            }
        })
    })

    function requestAjax (uri, callback) {
        var url = appUrl + uri
        $.ajax({
            type: 'GET',
            url: url,
            success: callback,
            error: callback,
            dataType: 'json'
        })
    }
</script>
</body>
</html>
